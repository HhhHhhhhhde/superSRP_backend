# ⚡ 超级石头剪刀布 - 后端快速部署

## 🎯 目标

将后端API部署到Railway，与前端 https://supersrp-production.up.railway.app/ 连通。

---

## 📦 第一步：推送代码到GitHub（5分钟）

### 1.1 打开PowerShell/终端

```powershell
# 进入后端项目目录
cd "d:\学习资料\哈基米哟大三上多\Server-side Development\Back end"
```

### 1.2 初始化Git并推送

```bash
# 初始化Git仓库
git init

# 添加所有文件
git add .

# 提交代码
git commit -m "部署后端到Railway"

# 创建GitHub仓库
# 1. 访问 https://github.com/new
# 2. 仓库名：super-rps-backend （公开/私有都可以）
# 3. 不要勾选任何初始化选项
# 4. 点击 Create repository

# 推送到GitHub（替换为你的GitHub用户名）
git remote add origin https://github.com/你的用户名/super-rps-backend.git
git branch -M main
git push -u origin main
```

---

## 🚀 第二步：部署到Railway（10分钟）

### 2.1 创建项目并部署

1. **访问Railway**
   - 打开 https://railway.app
   - 使用GitHub账号登录

2. **新建项目**
   - 点击 **"New Project"**
   - 选择 **"Deploy from GitHub repo"**
   - 选择 `super-rps-backend` 仓库
   - 点击 **"Deploy Now"**

3. **等待部署**
   - Railway会自动检测Java项目
   - 运行 `mvn clean package`
   - 启动应用（约3-5分钟）

### 2.2 添加MySQL数据库

1. **创建数据库**
   - 在项目页面，点击右上角 **"+ New"**
   - 选择 **"Database"** → **"Add MySQL"**
   - 等待MySQL实例创建完成

2. **连接数据库和服务**
   - Railway会自动设置环境变量：
     - `MYSQLHOST`
     - `MYSQLPORT`
     - `MYSQLDATABASE`
     - `MYSQLUSER`
     - `MYSQLPASSWORD`

### 2.3 配置环境变量

1. **打开设置**
   - 点击后端服务（super-rps-backend）
   - 切换到 **"Variables"** 标签

2. **添加变量**（点击 **"+ New Variable"**）

```bash
# 变量名称：SPRING_DATASOURCE_URL
# 变量值：
jdbc:mysql://${MYSQLHOST}:${MYSQLPORT}/${MYSQLDATABASE}?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true

# 变量名称：SPRING_DATASOURCE_USERNAME
# 变量值：
${MYSQLUSER}

# 变量名称：SPRING_DATASOURCE_PASSWORD
# 变量值：
${MYSQLPASSWORD}

# 变量名称：JWT_SECRET
# 变量值（随便改成你的密钥）：
your-secret-jwt-key-2025-production-super-rps

# 变量名称：JWT_EXPIRATION
# 变量值：
604800000
```

3. **保存并重新部署**
   - 环境变量会触发自动重新部署

### 2.4 初始化数据库

#### 方法一：使用Railway控制台

1. 点击MySQL服务
2. 点击 **"Data"** 标签
3. 点击 **"Query"** 按钮
4. 复制 `database/init.sql` 的内容
5. 粘贴并执行

#### 方法二：使用MySQL客户端

1. 获取连接信息（在MySQL服务的 **"Connect"** 标签）
2. 使用任意MySQL客户端连接
3. 执行 `init.sql`

### 2.5 生成访问域名

1. 点击后端服务
2. 切换到 **"Settings"** 标签
3. 找到 **"Domains"** 部分
4. 点击 **"Generate Domain"**
5. 复制生成的域名（如：`super-rps-backend-xxx.up.railway.app`）

---

## 🔗 第三步：连接前后端（5分钟）

### 3.1 测试后端API

在浏览器或curl中测试：

```bash
# 替换为你的后端域名
https://your-backend.up.railway.app/api/auth/check
```

应该返回：
```json
{
  "success": true,
  "code": 200,
  "message": "success",
  "data": {
    "authenticated": false,
    "userInfo": null
  }
}
```

### 3.2 更新前端API地址

修改前端项目中的3个文件，将API地址改为你的后端域名：

#### 文件1：`Front end/src/main/resources/static/js/auth.js`

找到第8行：
```javascript
const API_CONFIG = {
  baseURL: 'https://your-backend.up.railway.app/api/auth',  // 👈 改这里
  endpoints: {
    login: '/login',
    register: '/register',
    logout: '/logout',
    checkAuth: '/check'
  }
};
```

#### 文件2：`Front end/src/main/resources/static/js/game.js`

找到第17行：
```javascript
const API_CONFIG = {
  baseURL: 'https://your-backend.up.railway.app/api/game',  // 👈 改这里
  endpoints: {
    save: '/save'
  }
};
```

#### 文件3：`Front end/src/main/resources/static/js/history.js`

找到第5行：
```javascript
const API_CONFIG = {
  baseURL: 'https://your-backend.up.railway.app/api/game',  // 👈 改这里
  endpoints: {
    history: '/history'
  }
};
```

### 3.3 重新部署前端

```bash
# 进入前端项目目录
cd "d:\学习资料\哈基米哟大三上多\Server-side Development\Front end"

# 提交更改
git add .
git commit -m "连接后端API"
git push
```

Railway会自动检测推送并重新部署前端（约2分钟）。

---

## ✅ 第四步：验证部署

### 4.1 访问前端

打开 https://supersrp-production.up.railway.app/

### 4.2 测试功能

1. **点击"登录"按钮**
2. **注册新账号**
   - 用户名：testuser
   - 密码：123456
3. **如果成功**，说明前后端已连通！🎉

### 4.3 查看数据

在Railway MySQL服务的 **"Data"** 标签中，可以看到新注册的用户数据。

---

## 🔍 故障排查

### 问题1：前端无法连接后端

**检查项：**
- [ ] 后端域名是否正确
- [ ] 后端服务是否正常运行（查看Logs）
- [ ] CORS配置是否正确
- [ ] 前端API地址是否已更新

**解决：**
查看Railway后端服务的 **"Deployments"** → **"View Logs"**

### 问题2：数据库连接失败

**症状：** 日志显示 `Communications link failure`

**解决：**
1. 检查环境变量是否正确设置
2. 确认MySQL服务已启动
3. 重新部署后端服务

### 问题3：注册/登录失败

**检查项：**
- [ ] 数据库是否已初始化（执行init.sql）
- [ ] JWT_SECRET是否已设置
- [ ] 后端日志中是否有错误

---

## 📊 监控和维护

### 查看日志

1. 进入Railway项目
2. 点击后端服务
3. 点击 **"Deployments"**
4. 点击最新部署的 **"View Logs"**

### 查看数据库

1. 点击MySQL服务
2. 点击 **"Data"** 标签
3. 可以查询和管理数据

### 重新部署

代码修改后：
```bash
git add .
git commit -m "更新内容"
git push
```

Railway会自动重新部署！

---

## 💰 费用说明

- **Railway免费额度**：$5/月
- **预计消耗**：
  - 后端：$1-2/月
  - MySQL：$1-2/月
  - **总计：$2-4/月**

免费额度完全够用！不需要绑定信用卡。

---

## 🎉 部署成功！

**你现在拥有：**
- ✅ 在线前端：https://supersrp-production.up.railway.app/
- ✅ 在线后端API：https://your-backend.up.railway.app/
- ✅ 云端MySQL数据库
- ✅ 完整的前后端分离架构

**可以分享给朋友一起玩了！** 🎮

---

## 📝 快速命令参考

```bash
# 部署后端
cd "Back end"
git init
git add .
git commit -m "deploy"
git remote add origin https://github.com/用户名/super-rps-backend.git
git push -u origin main

# 更新前端
cd "Front end"
git add .
git commit -m "update api url"
git push

# 查看Railway项目
# https://railway.app/project/你的项目ID
```

---

**祝部署顺利！** 🚀

如有问题，查看 `DEPLOY_RAILWAY.md` 获取详细文档。

